<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sông Hương Knowledge Galaxy v2 | Dannz Studio</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,600;1,500&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #020617;
            --gold: #f59e0b;
            --river: #0ea5e9;
            --poetry: #d8b4fe;
            --accent: #10b981;
        }
        body {
            margin: 0;
            background: var(--bg-deep);
            color: #f1f5f9;
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        .serif { font-family: 'Cormorant Garamond', serif; }

        #galaxy-container { width: 100%; height: 100%; cursor: move; }

        /* Node Styling */
        .node circle {
            stroke-width: 2px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.1));
        }
        .node:hover circle {
            stroke-width: 6px;
            filter: drop-shadow(0 0 20px currentColor);
        }
        .node text {
            font-size: 10px;
            font-weight: 700;
            pointer-events: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            fill: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,1);
        }

        .link {
            fill: none;
            stroke-opacity: 0.2;
            stroke-dasharray: 5, 5;
        }

        /* Overlay */
        #data-panel {
            position: fixed;
            right: -450px;
            top: 20px;
            bottom: 20px;
            width: 400px;
            background: rgba(10, 15, 30, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 30px;
            transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 100;
            display: flex;
            flex-direction: column;
            box-shadow: -20px 0 50px rgba(0,0,0,0.5);
        }
        #data-panel.active { right: 20px; }

        .close-btn { 
            cursor: pointer; 
            color: var(--gold); 
            font-size: 11px; 
            margin-bottom: 20px;
            letter-spacing: 2px;
            display: inline-block;
            border-bottom: 1px solid transparent;
        }
        .close-btn:hover { border-bottom-color: var(--gold); }
        
        .content-scroll::-webkit-scrollbar { width: 2px; }
        .content-scroll::-webkit-scrollbar-thumb { background: var(--gold); }

        .quote-box {
            border-left: 3px solid var(--gold);
            padding-left: 15px;
            margin: 20px 0;
            font-style: italic;
            background: rgba(245, 158, 11, 0.05);
            padding-top: 10px;
            padding-bottom: 10px;
        }

        .hud { position: fixed; pointer-events: none; z-index: 50; }
    </style>
</head>
<body>

    <div class="fixed inset-0 opacity-10 pointer-events-none" 
         style="background-image: radial-gradient(#64748b 1px, transparent 1px); background-size: 30px 30px;"></div>

    <div class="hud top-8 left-8">
        <h1 class="serif text-6xl italic font-bold text-amber-500 mb-1 leading-none">Hương Giang</h1>
        <p class="text-[10px] uppercase tracking-[0.6em] text-slate-400">Deep Knowledge Architecture / v2.1</p>
    </div>

    <div id="data-panel">
        <div class="close-btn" onclick="togglePanel(false)">[ CLS - THOÁT ]</div>
        <div id="panel-body" class="flex flex-1 flex-col overflow-hidden">
            <div id="panel-header"></div>
            <div class="h-px bg-white/10 my-6"></div>
            <div id="panel-content" class="content-scroll overflow-y-auto flex-1 text-slate-300 pr-4">
                <!-- Data will be injected here -->
            </div>
        </div>
    </div>

    <div id="galaxy-container"></div>

    <script>
        const riverData = {
            id: "Root",
            name: "SÔNG HƯƠNG",
            color: "#f59e0b",
            val: 45,
            info: "Một sinh thể có tâm hồn, không chỉ là dòng chảy địa lý mà là hiện thân của văn hóa và lịch sử Huế.",
            children: [
                {
                    id: "ThuongNguon",
                    name: "THƯỢNG NGUỒN",
                    color: "#f43f5e",
                    val: 32,
                    info: "Khúc trường ca của rừng già, nơi Sông Hương bộc lộ bản ngã nguyên sơ, mạnh mẽ và tự do nhất.",
                    children: [
                        { 
                            name: "Cô gái Di-gan", 
                            val: 18, 
                            color: "#fb7185",
                            info: "Hình ảnh ẩn dụ cho vẻ đẹp hoang dại, phóng khoáng và tràn đầy sức sống của dòng sông giữa đại ngàn Trường Sơn.",
                            detail: "Tác giả nhìn thấy ở dòng sông một 'bản năng tự do'. Giống như những cô gái Di-gan ưa thích sự xê dịch và ca hát, Sông Hương ở thượng nguồn không bị kiềm tỏa, nó nhảy múa và ca hát giữa những ghềnh thác.",
                            quote: "Như một cô gái Di-gan phóng khoáng và man dại... rừng già đã hun đúc cho nó một bản lĩnh gan góc, một tâm hồn tự do và trong sáng."
                        },
                        { 
                            name: "Bản trường ca", 
                            val: 18, 
                            color: "#fb7185",
                            info: "Âm hưởng hùng tráng của thiên nhiên kỳ vĩ.",
                            detail: "Sông Hương không lặng lẽ mà 'rầm rộ giữa bóng cây đại ngàn', 'mãnh liệt qua những ghềnh thác'. Đây là giai đoạn dòng sông sống hết mình với sức mạnh cơ bắp của thiên nhiên.",
                            quote: "Rầm rộ giữa bóng cây đại ngàn, mãnh liệt qua những ghềnh thác, cuộn xoáy như cơn lốc vào những đáy vực bí ẩn."
                        },
                        { 
                            name: "Người mẹ phù sa", 
                            val: 18, 
                            color: "#fb7185",
                            info: "Sự chuyển hóa từ bản năng sang mẫu tính.",
                            detail: "Trước khi rời khỏi rừng già, dòng sông đã 'chế ngự bản năng' để trở thành người mẹ bồi đắp cho một vùng văn hóa. Đây là sự hy sinh và chuẩn bị cho hành trình về đồng bằng.",
                            quote: "Dòng sông đã đóng kín lại ở cửa rừng và ném chìa khóa vào những hang đá dưới chân núi Kim Phụng."
                        }
                    ]
                },
                {
                    id: "NgoaiO",
                    name: "NGOẠI Ô HUẾ",
                    color: "#10b981",
                    val: 32,
                    info: "Hành trình tìm kiếm 'người tình mong đợi' với những biến ảo sắc màu và hình dáng.",
                    children: [
                        { 
                            name: "Người gái đẹp ngủ mơ", 
                            val: 18, 
                            color: "#34d399",
                            info: "Vẻ đẹp trữ tình, lãng mạn của dòng sông khi bắt đầu về gần thành phố.",
                            detail: "Dòng sông lúc này như đang được đánh thức sau một giấc ngủ dài. Nó uốn lượn liên tục, tạo nên những đường cong mềm mại như đang làm duyên.",
                            quote: "Sông Hương chuyển dòng liên tục, uốn mình theo những đường cong thật mềm... như một cuộc tìm kiếm có ý thức để đi tới nơi gặp thành phố của nó."
                        },
                        { 
                            name: "Sắc thái biến ảo", 
                            val: 18, 
                            color: "#34d399",
                            info: "Sự nhạy cảm tuyệt đối về quang học và màu sắc.",
                            detail: "Hoàng Phủ Ngọc Tường không chỉ viết văn mà còn vẽ tranh bằng chữ. Ông quan sát sự phản quang của mây trời trên mặt nước qua các thời điểm trong ngày.",
                            quote: "Sớm xanh, trưa vàng, chiều tím... những ngọn đồi này mang vẻ đẹp trầm mặc nhất của vùng văn hóa kết tinh."
                        }
                    ]
                },
                {
                    id: "KinhThanh",
                    name: "TRONG LÒNG HUẾ",
                    color: "#0ea5e9",
                    val: 32,
                    info: "Cuộc hội ngộ định mệnh, nơi dòng sông tìm thấy chính mình trong sự tĩnh lặng và âm nhạc.",
                    children: [
                        { 
                            name: "Điệu Slow tình cảm", 
                            val: 18, 
                            color: "#7dd3fc",
                            info: "Nhịp chảy đặc trưng không nơi nào có được.",
                            detail: "Do địa thế, sông Hương chảy rất chậm khi vào thành phố. Tác giả đã nhân hóa cái chậm này thành nỗi lòng của một người yêu không muốn rời xa người mình yêu.",
                            quote: "Đấy là điệu slow tình cảm dành riêng cho Huế... như một tiếng 'vâng' không nói ra của tình yêu."
                        },
                        { 
                            name: "Linh hồn âm nhạc", 
                            val: 18, 
                            color: "#7dd3fc",
                            info: "Mối liên hệ giữa dòng sông và Nhã nhạc.",
                            detail: "Toàn bộ âm nhạc cổ truyền Huế được sinh ra trên mặt nước này. Tiếng mái chèo, tiếng nước vỗ đã hun đúc nên tâm hồn âm nhạc dân tộc.",
                            quote: "Hình như trong khoảnh khắc trùng lại của dòng sông, những người thợ tài hoa đã dệt nên những bản nhạc làm say lòng người."
                        }
                    ]
                },
                {
                    id: "NgheThuat",
                    name: "NGHỆ THUẬT BÚT KÝ",
                    color: "#ec4899",
                    val: 32,
                    info: "Phong cách cá nhân độc đáo: Uyên bác, tài hoa và giàu chất thơ.",
                    children: [
                        { 
                            name: "Tri thức đa ngành", 
                            val: 18, 
                            color: "#f472b6",
                            info: "Sự kết hợp giữa địa lý, lịch sử và văn hóa.",
                            detail: "Tác giả không chỉ nhìn sông Hương như một dòng nước mà nhìn nó xuyên qua các tầng nấc thời gian và không gian của sử thi.",
                            quote: "Dòng sông của thời gian có thể trôi đi, nhưng dòng sông của văn hóa thì ở lại mãi mãi."
                        },
                        { 
                            name: "Lối văn hướng nội", 
                            val: 18, 
                            color: "#f472b6",
                            info: "Sự mê đắm trong ngôn từ.",
                            detail: "Câu văn của ông thường dài, sử dụng nhiều tính từ và trạng từ cực độ, tạo ra một không gian huyền ảo, sương khói.",
                            quote: "Một lối văn soi bóng tâm hồn, đầy rẫy những suy tư chiêm nghiệm về cuộc đời và con người."
                        }
                    ]
                }
            ]
        };

        const width = window.innerWidth;
        const height = window.innerHeight;

        const svg = d3.select("#galaxy-container")
            .append("svg")
            .attr("viewBox", [0, 0, width, height]);

        const container = svg.append("g");

        svg.call(d3.zoom()
            .scaleExtent([0.5, 3])
            .on("zoom", (e) => container.attr("transform", e.transform)));

        const root = d3.hierarchy(riverData);
        const links = root.links();
        const nodes = root.descendants();

        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(140).strength(0.8))
            .force("charge", d3.forceManyBody().strength(-1200))
            .force("center", d3.forceCenter(width / 2.5, height / 2))
            .force("collision", d3.forceCollide().radius(d => d.data.val + 30));

        const link = container.append("g")
            .selectAll("path")
            .data(links)
            .join("path")
            .attr("class", "link")
            .attr("stroke", d => d.target.data.color)
            .attr("stroke-width", 1.5);

        const node = container.append("g")
            .selectAll("g")
            .data(nodes)
            .join("g")
            .attr("class", "node")
            .on("click", (e, d) => {
                e.stopPropagation();
                showDetailedInfo(d.data);
            })
            .call(d3.drag()
                .on("start", (e, d) => {
                    if (!e.active) simulation.alphaTarget(0.3).restart();
                    d.fx = d.x; d.fy = d.y;
                })
                .on("drag", (e, d) => {
                    d.fx = e.x; d.fy = e.y;
                })
                .on("end", (e, d) => {
                    if (!e.active) simulation.alphaTarget(0);
                    d.fx = null; d.fy = null;
                }));

        node.append("circle")
            .attr("r", d => d.data.val)
            .attr("fill", d => d.data.color)
            .attr("fill-opacity", 0.1)
            .attr("stroke", d => d.data.color);

        node.append("text")
            .attr("dy", d => d.children ? -d.data.val - 12 : 5)
            .attr("text-anchor", "middle")
            .text(d => d.data.name);

        simulation.on("tick", () => {
            link.attr("d", d => `M${d.source.x},${d.source.y} L${d.target.x},${d.target.y}`);
            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        function showDetailedInfo(item) {
            const panel = d3.select("#data-panel");
            const header = d3.select("#panel-header");
            const content = d3.select("#panel-content");

            panel.classed("active", true);

            header.html(`
                <div class="flex items-center gap-4 mb-2">
                    <div class="w-4 h-4 rounded-full" style="background:${item.color}"></div>
                    <span class="text-[10px] tracking-widest text-slate-500 uppercase">Khám phá chi tiết</span>
                </div>
                <h2 class="serif text-4xl font-bold italic text-white">${item.name}</h2>
            `);

            let htmlContent = `
                <div class="animate-fadeIn">
                    <p class="text-xl text-amber-400/90 italic font-light leading-relaxed mb-6">"${item.info}"</p>
            `;

            if (item.detail) {
                htmlContent += `
                    <div class="mb-6">
                        <h4 class="text-xs font-extrabold text-white/40 uppercase tracking-tighter mb-3">Phân tích chuyên sâu</h4>
                        <p class="leading-relaxed text-slate-300">${item.detail}</p>
                    </div>
                `;
            }

            if (item.quote) {
                htmlContent += `
                    <div class="quote-box">
                        <p class="text-sm text-amber-100/80 leading-relaxed font-serif">"${item.quote}"</p>
                        <p class="text-[9px] mt-2 text-amber-500/50 uppercase tracking-widest">— Hoàng Phủ Ngọc Tường</p>
                    </div>
                `;
            }

            if (item.children) {
                htmlContent += `
                    <div class="mt-8">
                        <h4 class="text-xs font-extrabold text-white/40 uppercase tracking-tighter mb-4">Các nhánh nhỏ liên quan</h4>
                        <div class="grid grid-cols-1 gap-2">
                            ${item.children.map(c => `
                                <div class="p-3 bg-white/5 border border-white/10 rounded-xl hover:bg-white/10 transition-colors cursor-pointer" onclick='event.stopPropagation(); showDetailedInfo(${JSON.stringify(c).replace(/'/g, "&apos;")})'>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-semibold">${c.name}</span>
                                        <span class="text-xs text-amber-500">→</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            htmlContent += `</div>`;
            content.html(htmlContent);
        }

        function togglePanel(val) {
            d3.select("#data-panel").classed("active", val);
        }

        // Click outside to close
        svg.on("click", () => togglePanel(false));

    </script>
</body>
</html>